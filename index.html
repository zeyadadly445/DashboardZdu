<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ - Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù†Ø©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; color: #333;
        }
        .container { 
            max-width: 1400px; margin: 0 auto; background: white; 
            min-height: 100vh; box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .header { 
            background: linear-gradient(45deg, #2c5aa0, #4facfe);
            color: white; padding: 20px; text-align: center;
        }
        .toolbar { 
            background: #f8f9fa; padding: 15px; border-bottom: 1px solid #dee2e6;
            display: flex; gap: 10px; flex-wrap: wrap; align-items: center;
        }
        .main-content { display: flex; height: calc(100vh - 140px); }
        .sidebar { 
            width: 350px; background: #f8f9fa; border-left: 1px solid #dee2e6;
            display: flex; flex-direction: column;
        }
        .tree-header { 
            background: #e9ecef; padding: 15px; font-weight: bold;
            border-bottom: 1px solid #dee2e6;
        }
        .tree-container { 
            flex: 1; overflow-y: auto; padding: 10px;
        }
        .tree-item { 
            margin: 2px 0; cursor: pointer; padding: 12px 15px;
            border-radius: 8px; transition: all 0.3s ease; position: relative;
            border: 2px solid transparent; font-size: 14px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .tree-item:hover { 
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5); 
            transform: translateX(-3px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            border-color: #2196f3;
        }
        .tree-item.selected { 
            background: linear-gradient(135deg, #2196f3, #1976d2); 
            color: white; 
            transform: translateX(-5px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
            border-color: #1565c0;
        }
        .tree-item.selected:hover {
            background: linear-gradient(135deg, #1976d2, #1565c0);
        }
        .tree-item:active {
            transform: translateX(-2px) scale(0.98);
        }
        .tree-item.subject { 
            font-weight: bold; 
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9); 
            border-right: 4px solid #4caf50; 
            margin-bottom: 8px;
        }
        .tree-item.subject:hover { 
            background: linear-gradient(135deg, #c8e6c9, #a5d6a7); 
            border-right-color: #388e3c;
        }
        .tree-item.subject.selected { 
            background: linear-gradient(135deg, #4caf50, #388e3c); 
            border-right-color: #2e7d32;
        }
        .tree-item.course { 
            margin-right: 20px; 
            background: linear-gradient(135deg, #fff3e0, #ffe0b2); 
            border-right: 4px solid #ff9800; 
            margin-bottom: 5px;
        }
        .tree-item.course:hover { 
            background: linear-gradient(135deg, #ffe0b2, #ffcc80); 
            border-right-color: #f57c00;
        }
        .tree-item.course.selected { 
            background: linear-gradient(135deg, #ff9800, #f57c00); 
            border-right-color: #ef6c00;
        }
        .tree-item.lesson { 
            margin-right: 40px; 
            background: linear-gradient(135deg, #f3e5f5, #e1bee7); 
            border-right: 4px solid #9c27b0; 
            margin-bottom: 3px;
        }
        .tree-item.lesson:hover { 
            background: linear-gradient(135deg, #e1bee7, #ce93d8); 
            border-right-color: #7b1fa2;
        }
        .tree-item.lesson.selected { 
            background: linear-gradient(135deg, #9c27b0, #7b1fa2); 
            border-right-color: #6a1b9a;
        }
        .details-panel { flex: 1; padding: 20px; overflow-y: auto; }
        .form-group { margin-bottom: 20px; }
        .form-group label { 
            display: block; margin-bottom: 8px; font-weight: 600; color: #495057;
        }
        .form-group input, .form-group textarea { 
            width: 100%; padding: 12px; border: 2px solid #e9ecef; 
            border-radius: 8px; font-size: 14px;
        }
        .btn { 
            background: #2196f3; color: white; border: none; 
            padding: 12px 24px; border-radius: 6px; cursor: pointer; 
            font-weight: 500; margin: 5px;
        }
        .btn:hover { background: #1976d2; }
        .btn-success { background: #4caf50; }
        .btn-warning { background: #ff9800; }
        .btn-danger { background: #f44336; }
        .modal { 
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; 
            width: 100%; height: 100%; background: rgba(0,0,0,0.5);
        }
        .modal-content { 
            background: white; margin: 5% auto; padding: 30px; 
            border-radius: 12px; width: 90%; max-width: 800px;
            max-height: 90vh; overflow-y: auto;
        }
        .close { 
            color: #aaa; float: left; font-size: 28px; 
            font-weight: bold; cursor: pointer;
        }
        .close:hover { color: #000; }
        .status { 
            padding: 10px; margin: 10px 0; border-radius: 5px;
            display: none;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .keyboard-help { 
            position: fixed; top: 20px; left: 20px; background: #333; 
            color: white; padding: 15px; border-radius: 8px; font-size: 12px;
            opacity: 0.9; max-width: 250px; z-index: 500;
        }
        .search-box { 
            margin: 10px 0; 
        }
        .search-box input { 
            width: 100%; padding: 10px; border: 2px solid #007bff; 
            border-radius: 5px; font-size: 14px;
        }
        .search-results { 
            max-height: 200px; overflow-y: auto; 
            border: 1px solid #dee2e6; border-radius: 5px;
            background: white; margin-top: 5px;
        }
        .search-result { 
            padding: 10px; border-bottom: 1px solid #f1f1f1; 
            cursor: pointer; transition: background 0.2s;
        }
        .search-result:hover { background: #f8f9fa; }
        .preview-content { 
            background: #f8f9fa; padding: 20px; border-radius: 8px;
            border: 1px solid #dee2e6; margin: 20px 0;
        }
        .preview-section { 
            margin: 15px 0; 
        }
        .preview-section h4 { 
            color: #495057; margin-bottom: 10px; 
        }
        .preview-section iframe { 
            width: 100%; height: 300px; border: 1px solid #ddd; 
            border-radius: 5px;
        }
        .preview-section a { 
            color: #007bff; text-decoration: none; 
        }
        .preview-section a:hover { 
            text-decoration: underline; 
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù…Ø³ ÙˆØ§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
        @media (max-width: 768px) {
            .tree-item {
                padding: 15px 18px;
                font-size: 16px;
                margin-bottom: 5px;
            }
            .tree-item:hover {
                transform: translateX(-2px);
            }
            .tree-item.selected {
                transform: translateX(-3px);
            }
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù„Ù…Ø³ */
        .tree-item:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.3);
        }
        
        .tree-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.1));
            transition: width 0.3s ease;
            border-radius: 8px 0 0 8px;
        }
        
        .tree-item:hover::before,
        .tree-item.selected::before {
            width: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</h1>
            <p>Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© - Ù…Ø¹ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ ÙˆÙ…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</p>
        </div>
        
        <div class="toolbar">
            <button class="btn btn-success" onclick="showAddModal('subject')">ğŸ“š Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
            <button class="btn btn-success" onclick="showAddModal('course')">ğŸ“– Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³</button>
            <button class="btn" onclick="showAddModal('lesson')">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³</button>
            <button class="btn btn-warning" onclick="showPreviewModal()">ğŸ‘€ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¯Ø±Ø³</button>
            <button class="btn" onclick="showSearchModal()">ğŸ” Ø¨Ø­Ø« (Ctrl+F)</button>
            <button class="btn" onclick="exportXML()">ğŸ’¾ ØªØµØ¯ÙŠØ± XML</button>
            <button class="btn" onclick="document.getElementById('import-file').click()">ğŸ“ Ø§Ø³ØªÙŠØ±Ø§Ø¯ XML</button>
            <input type="file" id="import-file" style="display:none" accept=".xml" onchange="importXML(this)">
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="tree-header">ğŸ—‚ï¸ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</div>
                <div class="tree-container" id="tree-container" tabindex="0">
                    <div style="text-align: center; padding: 50px 20px; color: #666;">
                        Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†<br>
                        <small>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</small>
                    </div>
                </div>
            </div>
            
            <div class="details-panel">
                <div id="status" class="status"></div>
                
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
                    <input type="text" id="subjectName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©">
                </div>
                
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³:</label>
                    <input type="text" id="courseName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³">
                </div>
                
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ø¯Ø±Ø³:</label>
                    <input type="text" id="lessonName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯Ø±Ø³">
                </div>
                
                <div class="form-group">
                    <label>Ø±Ø§Ø¨Ø· PDF:</label>
                    <textarea id="pdf" rows="2" placeholder="Ø±Ø§Ø¨Ø· Ù…Ù„Ù PDF Ø£Ùˆ ÙƒÙˆØ¯ Ù…Ø¶Ù…Ù†"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØª:</label>
                    <textarea id="audio" rows="2" placeholder="Ø±Ø§Ø¨Ø· Ù…Ù„Ù Ø§Ù„ØµÙˆØª Ø£Ùˆ ÙƒÙˆØ¯ Ù…Ø¶Ù…Ù†"></textarea>
                </div>
                
                <div class="form-group">
                    <label>ÙƒÙˆØ¯ ÙŠÙˆØªÙŠÙˆØ¨:</label>
                    <textarea id="youtube" rows="3" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØªØ¶Ù…ÙŠÙ† Ù…Ù† ÙŠÙˆØªÙŠÙˆØ¨ Ø£Ùˆ Ø±Ø§Ø¨Ø·"></textarea>
                </div>
                
                <div class="form-group">
                    <label>ÙƒÙˆØ¯ Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ:</label>
                    <textarea id="drive" rows="3" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØªØ¶Ù…ÙŠÙ† Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ Ø£Ùˆ Ø±Ø§Ø¨Ø·"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Ù…Ø­ØªÙˆÙ‰ HTML:</label>
                    <textarea id="html" rows="10" placeholder="Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø¨ØµÙŠØºØ© HTML"></textarea>
                </div>
                
                <button class="btn" onclick="saveLesson()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø³ (Ctrl+S)</button>
                <button class="btn" onclick="updateNames()">âœï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Modal Ù„Ù„Ø¥Ø¶Ø§ÙØ© -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3 id="modal-title">Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯</h3>
            <div class="form-group">
                <label id="modal-label">Ø§Ù„Ø§Ø³Ù…:</label>
                <input type="text" id="modal-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…">
            </div>
            <div class="form-group" id="subject-select-group" style="display:none">
                <label>Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
                <select id="subject-select"></select>
            </div>
            <div class="form-group" id="course-select-group" style="display:none">
                <label>Ø§Ù„ÙƒÙˆØ±Ø³:</label>
                <select id="course-select"></select>
            </div>
            <button class="btn" onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
    </div>

    <!-- Modal Ù„Ù„Ø¨Ø­Ø« -->
    <div id="search-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSearchModal()">&times;</span>
            <h3>ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3>
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„ÙƒÙˆØ±Ø³Ø§Øª ÙˆØ§Ù„Ø¯Ø±ÙˆØ³..." onkeyup="performSearch()">
            </div>
            <div id="search-results" class="search-results" style="display:none"></div>
        </div>
    </div>

    <!-- Modal Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© -->
    <div id="preview-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePreviewModal()">&times;</span>
            <h3 id="preview-title">ğŸ‘€ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¯Ø±Ø³</h3>
            <div id="preview-content" class="preview-content">
                <p style="text-align: center; color: #666;">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯Ø±Ø³ Ù„Ù…Ø¹Ø§ÙŠÙ†ØªÙ‡</p>
            </div>
        </div>
    </div>

    <!-- Ù…Ø³Ø§Ø¹Ø¯ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ -->
    <div class="keyboard-help">
        <strong>âŒ¨ï¸ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯:</strong><br>
        <strong>Ctrl+S:</strong> Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø³<br>
        <strong>Ctrl+F:</strong> Ø¨Ø­Ø«<br>
        <strong>Delete:</strong> Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯<br>
        <strong>Escape:</strong> Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ°
    </div>

    <script>
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        let subjects = JSON.parse(localStorage.getItem('educationData')) || [];
        let currentSelection = { subject: null, course: null, lesson: null };
        let modalType = '';

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        window.onload = function() {
            updateTree();
            showStatus('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            setupKeyboardShortcuts();
        };

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Ctrl+S Ù„Ù„Ø­ÙØ¸
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveLesson();
                }
                
                // Ctrl+F Ù„Ù„Ø¨Ø­Ø«
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    showSearchModal();
                }
                
                // Delete Ù„Ù„Ø­Ø°Ù
                if (e.key === 'Delete') {
                    deleteSelectedItem();
                }
                
                // Escape Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ°
                if (e.key === 'Escape') {
                    closeAllModals();
                }
                
                // Enter ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©
                if (e.key === 'Enter' && document.getElementById('modal').style.display === 'block') {
                    addItem();
                }
                
                // Enter ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø­Ø«
                if (e.key === 'Enter' && document.getElementById('search-modal').style.display === 'block') {
                    performSearch();
                }
            });
        }

        // Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯
        function deleteSelectedItem() {
            const { subject, course, lesson } = currentSelection;
            
            if (!subject) {
                showStatus('Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø¹Ù†ØµØ± Ù„Ù„Ø­Ø°Ù', 'error');
                return;
            }
            
            let message = '';
            if (lesson) {
                message = `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø³ "${lesson}"ØŸ`;
            } else if (course) {
                message = `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ±Ø³ "${course}" ÙˆØ¬Ù…ÙŠØ¹ Ø¯Ø±ÙˆØ³Ù‡ØŸ`;
            } else {
                message = `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø© "${subject}" ÙˆØ¬Ù…ÙŠØ¹ Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡Ø§ØŸ`;
            }
            
            if (confirm(message)) {
                if (lesson) {
                    deleteLesson(subject, course, lesson);
                } else if (course) {
                    deleteCourse(subject, course);
                } else {
                    deleteSubject(subject);
                }
            }
        }

        // Ø­Ø°Ù Ù…Ø§Ø¯Ø©
        function deleteSubject(subjectName) {
            subjects = subjects.filter(s => s.name !== subjectName);
            currentSelection = { subject: null, course: null, lesson: null };
            clearFields();
            saveData();
            updateTree();
            showStatus(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø©: ${subjectName}`, 'success');
        }

        // Ø­Ø°Ù ÙƒÙˆØ±Ø³
        function deleteCourse(subjectName, courseName) {
            const subject = subjects.find(s => s.name === subjectName);
            if (subject) {
                subject.courses = subject.courses.filter(c => c.name !== courseName);
                currentSelection.course = null;
                currentSelection.lesson = null;
                clearFields();
                saveData();
                updateTree();
                showStatus(`ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ±Ø³: ${courseName}`, 'success');
            }
        }

        // Ø­Ø°Ù Ø¯Ø±Ø³
        function deleteLesson(subjectName, courseName, lessonName) {
            const subject = subjects.find(s => s.name === subjectName);
            if (subject) {
                const course = subject.courses.find(c => c.name === courseName);
                if (course) {
                    course.lessons = course.lessons.filter(l => l.name !== lessonName);
                    currentSelection.lesson = null;
                    clearFields();
                    saveData();
                    updateTree();
                    showStatus(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø³: ${lessonName}`, 'success');
                }
            }
        }

        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
        function clearFields() {
            document.getElementById('subjectName').value = '';
            document.getElementById('courseName').value = '';
            document.getElementById('lessonName').value = '';
            document.getElementById('pdf').value = '';
            document.getElementById('audio').value = '';
            document.getElementById('youtube').value = '';
            document.getElementById('drive').value = '';
            document.getElementById('html').value = '';
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ÙˆØ§ÙØ°
        function closeAllModals() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('search-modal').style.display = 'none';
            document.getElementById('preview-modal').style.display = 'none';
        }

        // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø­Ø«
        function showSearchModal() {
            document.getElementById('search-modal').style.display = 'block';
            document.getElementById('search-input').focus();
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø­Ø«
        function closeSearchModal() {
            document.getElementById('search-modal').style.display = 'none';
            document.getElementById('search-results').style.display = 'none';
        }

        // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø«
        function performSearch() {
            const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
            const resultsContainer = document.getElementById('search-results');
            
            if (!searchTerm) {
                resultsContainer.style.display = 'none';
                return;
            }
            
            const results = [];
            subjects.forEach(subject => {
                subject.courses.forEach(course => {
                    course.lessons.forEach(lesson => {
                        if (subject.name.toLowerCase().includes(searchTerm) ||
                            course.name.toLowerCase().includes(searchTerm) ||
                            lesson.name.toLowerCase().includes(searchTerm) ||
                            (lesson.html && cleanCDATA(lesson.html).toLowerCase().includes(searchTerm)) ||
                            (lesson.pdf && cleanCDATA(lesson.pdf).toLowerCase().includes(searchTerm)) ||
                            (lesson.audio && cleanCDATA(lesson.audio).toLowerCase().includes(searchTerm)) ||
                            (lesson.youtube_embed && cleanCDATA(lesson.youtube_embed).toLowerCase().includes(searchTerm)) ||
                            (lesson.drive_embed && cleanCDATA(lesson.drive_embed).toLowerCase().includes(searchTerm))) {
                            
                            results.push({
                                subject: subject.name,
                                course: course.name,
                                lesson: lesson.name,
                                path: `${subject.name} > ${course.name} > ${lesson.name}`
                            });
                        }
                    });
                });
            });
            
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="search-result">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</div>';
            } else {
                resultsContainer.innerHTML = results.map(result => 
                    `<div class="search-result" onclick="selectSearchResult('${result.subject}', '${result.course}', '${result.lesson}')">
                        ${result.path}
                    </div>`
                ).join('');
            }
            
            resultsContainer.style.display = 'block';
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ù†ØªÙŠØ¬Ø© Ø¨Ø­Ø«
        function selectSearchResult(subject, course, lesson) {
            selectItem('lesson', subject, course, lesson);
            closeSearchModal();
            
            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ± ÙˆØªØ­Ø¯ÙŠØ¯Ù‡ Ù…Ø±Ø¦ÙŠØ§Ù‹
            setTimeout(() => {
                const treeItems = document.querySelectorAll('.tree-item');
                treeItems.forEach(item => {
                    if (item.textContent.includes(lesson)) {
                        item.classList.add('selected');
                        item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
            }, 100);
            
            showStatus(`ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰: ${lesson}`, 'success');
        }

        // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        function showPreviewModal() {
            const { subject, course, lesson } = currentSelection;
            
            if (!lesson) {
                showStatus('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯Ø±Ø³ Ù„Ù…Ø¹Ø§ÙŠÙ†ØªÙ‡', 'error');
                return;
            }
            
            const lessonData = getLessonData(subject, course, lesson);
            if (!lessonData) {
                showStatus('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø±Ø³', 'error');
                return;
            }
            
            document.getElementById('preview-title').textContent = `ğŸ‘€ Ù…Ø¹Ø§ÙŠÙ†Ø©: ${lesson}`;
            
            let previewHTML = `
                <h3>${subject} > ${course} > ${lesson}</h3>
                <hr style="margin: 15px 0;">
            `;
            
            // Ù…Ø¹Ø§ÙŠÙ†Ø© PDF
            if (lessonData.pdf) {
                const pdfContent = lessonData.pdf.trim();
                previewHTML += `
                    <div class="preview-section">
                        <h4>ğŸ“„ Ù…Ø­ØªÙˆÙ‰ PDF:</h4>
                `;
                
                if (pdfContent.includes('<iframe') || pdfContent.includes('<embed')) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒÙˆØ¯ Ù…Ø¶Ù…Ù†
                    previewHTML += `<div style="border: 1px solid #ddd; padding: 10px; background: white; border-radius: 5px;">${pdfContent}</div>`;
                } else {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ø§Ø¨Ø·
                    previewHTML += `<a href="${pdfContent}" target="_blank">${pdfContent}</a>`;
                }
                
                previewHTML += `</div>`;
            }
            
            // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØª
            if (lessonData.audio) {
                const audioContent = lessonData.audio.trim();
                previewHTML += `
                    <div class="preview-section">
                        <h4>ğŸµ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª:</h4>
                `;
                
                if (audioContent.includes('<audio') || audioContent.includes('<iframe') || audioContent.includes('<embed')) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒÙˆØ¯ Ù…Ø¶Ù…Ù†
                    previewHTML += `<div style="border: 1px solid #ddd; padding: 10px; background: white; border-radius: 5px;">${audioContent}</div>`;
                } else {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ø§Ø¨Ø· ØµÙˆØª
                    previewHTML += `
                        <audio controls style="width: 100%;">
                            <source src="${audioContent}" type="audio/mpeg">
                            Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
                        </audio>
                    `;
                }
                
                previewHTML += `</div>`;
            }
            
            // Ù…Ø¹Ø§ÙŠÙ†Ø© ÙŠÙˆØªÙŠÙˆØ¨
            if (lessonData.youtube_embed) {
                const youtubeContent = lessonData.youtube_embed.trim();
                previewHTML += `
                    <div class="preview-section">
                        <h4>ğŸ“º Ù…Ø­ØªÙˆÙ‰ ÙŠÙˆØªÙŠÙˆØ¨:</h4>
                `;
                
                if (youtubeContent.includes('<iframe') || youtubeContent.includes('<embed')) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒÙˆØ¯ Ù…Ø¶Ù…Ù†
                    previewHTML += `<div style="border: 1px solid #ddd; padding: 10px; background: white; border-radius: 5px;">${youtubeContent}</div>`;
                } else if (youtubeContent.includes('youtube.com') || youtubeContent.includes('youtu.be')) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ØŒ ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ø¥Ø·Ø§Ø± Ù…Ø¶Ù…Ù†
                    let videoId = '';
                    if (youtubeContent.includes('youtu.be/')) {
                        videoId = youtubeContent.split('youtu.be/')[1].split('?')[0];
                    } else if (youtubeContent.includes('watch?v=')) {
                        videoId = youtubeContent.split('watch?v=')[1].split('&')[0];
                    }
                    
                    if (videoId) {
                        previewHTML += `<iframe src="https://www.youtube.com/embed/${videoId}" width="100%" height="300" allowfullscreen></iframe>`;
                    } else {
                        previewHTML += `<a href="${youtubeContent}" target="_blank">${youtubeContent}</a>`;
                    }
                } else {
                    previewHTML += `<div style="border: 1px solid #ddd; padding: 10px; background: white; border-radius: 5px;">${youtubeContent}</div>`;
                }
                
                previewHTML += `</div>`;
            }
            
            // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ
            if (lessonData.drive_embed) {
                const driveContent = lessonData.drive_embed.trim();
                previewHTML += `
                    <div class="preview-section">
                        <h4>â˜ï¸ Ù…Ø­ØªÙˆÙ‰ Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ:</h4>
                `;
                
                if (driveContent.includes('<iframe') || driveContent.includes('<embed')) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒÙˆØ¯ Ù…Ø¶Ù…Ù†
                    previewHTML += `<div style="border: 1px solid #ddd; padding: 10px; background: white; border-radius: 5px;">${driveContent}</div>`;
                } else {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ø§Ø¨Ø·
                    previewHTML += `<a href="${driveContent}" target="_blank">${driveContent}</a>`;
                }
                
                previewHTML += `</div>`;
            }
            
            // Ù…Ø¹Ø§ÙŠÙ†Ø© HTML
            if (lessonData.html) {
                previewHTML += `
                    <div class="preview-section">
                        <h4>ğŸŒ Ù…Ø­ØªÙˆÙ‰ HTML:</h4>
                        <div style="border: 1px solid #ddd; padding: 15px; background: white; border-radius: 5px;">
                            ${cleanCDATA(lessonData.html)}
                        </div>
                    </div>
                `;
            }
            
            if (!lessonData.pdf && !lessonData.audio && !lessonData.youtube_embed && !lessonData.drive_embed && !lessonData.html) {
                previewHTML += '<p style="text-align: center; color: #666;">Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø¨Ø¹Ø¯</p>';
            }
            
            document.getElementById('preview-content').innerHTML = previewHTML;
            document.getElementById('preview-modal').style.display = 'block';
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        function closePreviewModal() {
            document.getElementById('preview-modal').style.display = 'none';
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø±Ø³
        function getLessonData(subjectName, courseName, lessonName) {
            const subject = subjects.find(s => s.name === subjectName);
            if (!subject) return null;
            
            const course = subject.courses.find(c => c.name === courseName);
            if (!course) return null;
            
            return course.lessons.find(l => l.name === lessonName);
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø­Ø§Ù„Ø©
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => status.style.display = 'none', 3000);
        }

        // ØªØ­Ø¯ÙŠØ« Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        function updateTree() {
            const container = document.getElementById('tree-container');
            
            if (subjects.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px 20px; color: #666;">
                        Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†<br>
                        <small>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</small>
                    </div>
                `;
                return;
            }

            let html = '';
            subjects.forEach(subject => {
                html += `<div class="tree-item subject" tabindex="0" onclick="selectItem('subject', '${subject.name}')" onkeydown="handleKeyPress(event, 'subject', '${subject.name}')">ğŸ“š ${subject.name}</div>`;
                
                subject.courses.forEach(course => {
                    html += `<div class="tree-item course" tabindex="0" onclick="selectItem('course', '${subject.name}', '${course.name}')" onkeydown="handleKeyPress(event, 'course', '${subject.name}', '${course.name}')">ğŸ“– ${course.name}</div>`;
                    
                    course.lessons.forEach(lesson => {
                        html += `<div class="tree-item lesson" tabindex="0" onclick="selectItem('lesson', '${subject.name}', '${course.name}', '${lesson.name}')" onkeydown="handleKeyPress(event, 'lesson', '${subject.name}', '${course.name}', '${lesson.name}')">ğŸ“ ${lesson.name}</div>`;
                    });
                });
            });
            
            container.innerHTML = html;
        }

        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¶ØºØ· Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ÙÙŠ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ø¬Ø±Ø©
        function handleKeyPress(event, type, subject, course = null, lesson = null) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                selectItem(type, subject, course, lesson);
            }
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ø´Ø¬Ø±Ø©
        function selectItem(type, subject, course = null, lesson = null) {
            currentSelection = { subject, course, lesson };
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('subjectName').value = subject || '';
            document.getElementById('courseName').value = course || '';
            document.getElementById('lessonName').value = lesson || '';
            
            // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø±Ø³ Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡
            if (type === 'lesson' && lesson) {
                loadLessonData(subject, course, lesson);
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±Ø¦ÙŠ Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø³Ù„Ø³
            document.querySelectorAll('.tree-item').forEach(item => {
                item.classList.remove('selected');
                item.style.transform = '';
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
            if (event && event.target) {
                event.target.classList.add('selected');
                // ØªÙ…Ø±ÙŠØ± Ø³Ù„Ø³ Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯
                event.target.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'nearest' 
                });
            }
            
            showStatus(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${lesson || course || subject}`, 'success');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø±Ø³
        function loadLessonData(subjectName, courseName, lessonName) {
            const lessonData = getLessonData(subjectName, courseName, lessonName);
            if (!lessonData) return;
            
            document.getElementById('pdf').value = cleanCDATA(lessonData.pdf || '');
            document.getElementById('audio').value = cleanCDATA(lessonData.audio || '');
            document.getElementById('youtube').value = cleanCDATA(lessonData.youtube_embed || '');
            document.getElementById('drive').value = cleanCDATA(lessonData.drive_embed || '');
            document.getElementById('html').value = cleanCDATA(lessonData.html || '');
        }

        // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        function showAddModal(type) {
            modalType = type;
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const label = document.getElementById('modal-label');
            const input = document.getElementById('modal-input');
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
            document.getElementById('subject-select-group').style.display = 'none';
            document.getElementById('course-select-group').style.display = 'none';
            
            switch(type) {
                case 'subject':
                    title.textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©';
                    label.textContent = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©:';
                    input.placeholder = 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©';
                    break;
                case 'course':
                    title.textContent = 'Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³ Ø¬Ø¯ÙŠØ¯';
                    label.textContent = 'Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³:';
                    input.placeholder = 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³';
                    updateSubjectSelect();
                    document.getElementById('subject-select-group').style.display = 'block';
                    break;
                case 'lesson':
                    title.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯';
                    label.textContent = 'Ø§Ø³Ù… Ø§Ù„Ø¯Ø±Ø³:';
                    input.placeholder = 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¯Ø±Ø³';
                    updateSubjectSelect();
                    document.getElementById('subject-select-group').style.display = 'block';
                    document.getElementById('course-select-group').style.display = 'block';
                    break;
            }
            
            input.value = '';
            modal.style.display = 'block';
            input.focus();
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯
        function updateSubjectSelect() {
            const select = document.getElementById('subject-select');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>';
            
            subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject.name;
                option.textContent = subject.name;
                select.appendChild(option);
            });
            
            select.onchange = updateCourseSelect;
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª
        function updateCourseSelect() {
            const subjectSelect = document.getElementById('subject-select');
            const courseSelect = document.getElementById('course-select');
            const selectedSubject = subjectSelect.value;
            
            courseSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³</option>';
            
            if (selectedSubject) {
                const subject = subjects.find(s => s.name === selectedSubject);
                if (subject) {
                    subject.courses.forEach(course => {
                        const option = document.createElement('option');
                        option.value = course.name;
                        option.textContent = course.name;
                        courseSelect.appendChild(option);
                    });
                }
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯
        function addItem() {
            const name = document.getElementById('modal-input').value.trim();
            if (!name) {
                showStatus('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…', 'error');
                return;
            }
            
            switch(modalType) {
                case 'subject':
                    addSubject(name);
                    break;
                case 'course':
                    const selectedSubject = document.getElementById('subject-select').value;
                    if (!selectedSubject) {
                        showStatus('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø¯Ø©', 'error');
                        return;
                    }
                    addCourse(name, selectedSubject);
                    break;
                case 'lesson':
                    const subjectName = document.getElementById('subject-select').value;
                    const courseName = document.getElementById('course-select').value;
                    if (!subjectName || !courseName) {
                        showStatus('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„ÙƒÙˆØ±Ø³', 'error');
                        return;
                    }
                    addLesson(name, subjectName, courseName);
                    break;
            }
            
            closeModal();
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©
        function addSubject(name) {
            if (subjects.find(s => s.name.toLowerCase() === name.toLowerCase())) {
                showStatus('Ø§Ù„Ù…Ø§Ø¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                return;
            }
            
            subjects.push({ name, courses: [] });
            saveData();
            updateTree();
            showStatus(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø©: ${name}`, 'success');
        }

        // Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³
        function addCourse(name, subjectName) {
            const subject = subjects.find(s => s.name === subjectName);
            if (!subject) {
                showStatus('Ø§Ù„Ù…Ø§Ø¯Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©', 'error');
                return;
            }
            
            if (subject.courses.find(c => c.name.toLowerCase() === name.toLowerCase())) {
                showStatus('Ø§Ù„ÙƒÙˆØ±Ø³ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                return;
            }
            
            subject.courses.push({ name, lessons: [] });
            saveData();
            updateTree();
            showStatus(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ±Ø³: ${name}`, 'success');
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³
        function addLesson(name, subjectName, courseName) {
            const subject = subjects.find(s => s.name === subjectName);
            if (!subject) {
                showStatus('Ø§Ù„Ù…Ø§Ø¯Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©', 'error');
                return;
            }
            
            const course = subject.courses.find(c => c.name === courseName);
            if (!course) {
                showStatus('Ø§Ù„ÙƒÙˆØ±Ø³ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }
            
            if (course.lessons.find(l => l.name.toLowerCase() === name.toLowerCase())) {
                showStatus('Ø§Ù„Ø¯Ø±Ø³ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                return;
            }
            
            course.lessons.push({
                name,
                pdf: '',
                audio: '',
                youtube_embed: '',
                drive_embed: '',
                html: ''
            });
            
            saveData();
            updateTree();
            showStatus(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³: ${name}`, 'success');
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø³
        function saveLesson() {
            const { subject, course, lesson } = currentSelection;
            if (!lesson) {
                showStatus('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯Ø±Ø³ Ù„Ø­ÙØ¸Ù‡', 'error');
                return;
            }
            
            const lessonData = getLessonData(subject, course, lesson);
            if (!lessonData) return;
            
            lessonData.pdf = cleanCDATA(document.getElementById('pdf').value);
            lessonData.audio = cleanCDATA(document.getElementById('audio').value);
            lessonData.youtube_embed = cleanCDATA(document.getElementById('youtube').value);
            lessonData.drive_embed = cleanCDATA(document.getElementById('drive').value);
            lessonData.html = cleanCDATA(document.getElementById('html').value);
            
            saveData();
            showStatus('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
        function updateNames() {
            const newSubject = document.getElementById('subjectName').value.trim();
            const newCourse = document.getElementById('courseName').value.trim();
            const newLesson = document.getElementById('lessonName').value.trim();
            
            const { subject, course, lesson } = currentSelection;
            
            if (lesson) {
                const subjectObj = subjects.find(s => s.name === subject);
                if (subjectObj) {
                    if (newSubject && newSubject !== subject) {
                        subjectObj.name = newSubject;
                        currentSelection.subject = newSubject;
                    }
                    
                    const courseObj = subjectObj.courses.find(c => c.name === course);
                    if (courseObj) {
                        if (newCourse && newCourse !== course) {
                            courseObj.name = newCourse;
                            currentSelection.course = newCourse;
                        }
                        
                        const lessonObj = courseObj.lessons.find(l => l.name === lesson);
                        if (lessonObj && newLesson && newLesson !== lesson) {
                            lessonObj.name = newLesson;
                            currentSelection.lesson = newLesson;
                        }
                    }
                }
                
                saveData();
                updateTree();
                showStatus('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        // ØªØµØ¯ÙŠØ± XML
        function exportXML() {
            if (subjects.length === 0) {
                showStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
                return;
            }
            
            let xml = '<?xml version="1.0" encoding="UTF-8"?>\n<subjects>\n';
            
            subjects.forEach(subject => {
                xml += `  <subject name="${escapeXml(subject.name)}">\n`;
                
                subject.courses.forEach(course => {
                    xml += `    <course name="${escapeXml(course.name)}">\n`;
                    
                    course.lessons.forEach(lesson => {
                        xml += `      <lesson name="${escapeXml(lesson.name)}">\n`;
                        xml += `        <pdf>${escapeXml(lesson.pdf || '')}</pdf>\n`;
                        xml += `        <audio>${escapeXml(lesson.audio || '')}</audio>\n`;
                        xml += `        <youtube_embed>${escapeXml(lesson.youtube_embed || '')}</youtube_embed>\n`;
                        xml += `        <drive_embed>${escapeXml(lesson.drive_embed || '')}</drive_embed>\n`;
                        xml += `        <html><![CDATA[${lesson.html || ''}]]></html>\n`;
                        xml += `      </lesson>\n`;
                    });
                    
                    xml += `    </course>\n`;
                });
                
                xml += `  </subject>\n`;
            });
            
            xml += '</subjects>';
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            const blob = new Blob([xml], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `education_data_${new Date().toISOString().slice(0,10)}.xml`;
            a.click();
            URL.revokeObjectURL(url);
            
            showStatus('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ XML
        function importXML(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const xml = e.target.result;
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(xml, 'text/xml');
                    
                    if (doc.querySelector('parsererror')) {
                        showStatus('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ù…Ù„Ù XML', 'error');
                        return;
                    }
                    
                    subjects = [];
                    const subjectNodes = doc.querySelectorAll('subject');
                    
                    subjectNodes.forEach(subjectNode => {
                        const subject = {
                            name: subjectNode.getAttribute('name'),
                            courses: []
                        };
                        
                        const courseNodes = subjectNode.querySelectorAll('course');
                        courseNodes.forEach(courseNode => {
                            const course = {
                                name: courseNode.getAttribute('name'),
                                lessons: []
                            };
                            
                            const lessonNodes = courseNode.querySelectorAll('lesson');
                            lessonNodes.forEach(lessonNode => {
                                const lesson = {
                                    name: lessonNode.getAttribute('name'),
                                    pdf: cleanCDATA(lessonNode.querySelector('pdf')?.textContent || ''),
                                    audio: cleanCDATA(lessonNode.querySelector('audio')?.textContent || ''),
                                    youtube_embed: cleanCDATA(lessonNode.querySelector('youtube_embed')?.textContent || ''),
                                    drive_embed: cleanCDATA(lessonNode.querySelector('drive_embed')?.textContent || ''),
                                    html: cleanCDATA(lessonNode.querySelector('html')?.textContent || '')
                                };
                                
                                course.lessons.push(lesson);
                            });
                            
                            subject.courses.push(course);
                        });
                        
                        subjects.push(subject);
                    });
                    
                    saveData();
                    updateTree();
                    showStatus('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    
                } catch (error) {
                    showStatus('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù', 'error');
                }
            };
            
            reader.readAsText(file, 'UTF-8');
            input.value = '';
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹
        function saveData() {
            localStorage.setItem('educationData', JSON.stringify(subjects));
        }

        // ØªØ´ÙÙŠØ± XML
        function escapeXml(text) {
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&apos;');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            const searchModal = document.getElementById('search-modal');
            const previewModal = document.getElementById('preview-modal');
            
            if (event.target == modal) {
                modal.style.display = 'none';
            }
            if (event.target == searchModal) {
                searchModal.style.display = 'none';
            }
            if (event.target == previewModal) {
                previewModal.style.display = 'none';
            }
        }

        // ØªÙ†Ø¸ÙŠÙ Ù…Ø­ØªÙˆÙ‰ HTML Ù…Ù† Ø¹Ù„Ø§Ù…Ø§Øª CDATA
        function cleanCDATA(content) {
            if (!content) return '';
            // Ø¥Ø²Ø§Ù„Ø© Ø¹Ù„Ø§Ù…Ø§Øª CDATA
            return content
                .replace(/<!\[CDATA\[/g, '')
                .replace(/\]\]>/g, '')
                .trim();
        }
    </script>
</body>
</html> 
